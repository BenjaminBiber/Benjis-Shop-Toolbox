@page "/settings"
@using Benjis_Shop_Toolbox.Models
@inject SettingsService SettingsService

<MudPaper Class="pa-4" Elevation="4">
    <MudText Typo="Typo.h5" Class="mb-4">Einstellungen</MudText>
    <MudSelect @bind-Value="Setting.IisAppName" Label="IIS App Name" Variant="Variant.Filled" Class="mb-2">
        @foreach (var site in _manager.Sites)
        {
            if (site != null)
            {
                <MudSelectItem Value="@site.Name">@site.Name</MudSelectItem>
            }
        }
    </MudSelect>
    <MudTextField @bind-Value="Setting.LogName" Label="Log Name" Variant="Variant.Filled" Class="mb-2" />
    <MudSelect T="int" @bind-Value="Setting.AutoRefreshSeconds" Label="Auto Refresh (Sekunden)" Class="mb-2">
        @foreach (var reloadTime in ReloadTime.ReloadTimes)
        {
            <MudSelectItem Value="@(Int32.Parse(reloadTime.Value.TotalSeconds.ToString()))">@reloadTime.Key</MudSelectItem>
        }
    </MudSelect>
    <MudSwitch @bind-Value="Setting.AutoRefreshEnabled" T="bool" Color="Color.Primary">Automatisches Aktualisieren</MudSwitch>
    <MudSwitch @bind-Value="Setting.LoadOnStartup" T="bool" Color="Color.Primary">Automatisch laden</MudSwitch>
    <MudSwitch @bind-Value="Setting.OnlySinceRestart" T="bool" Color="Color.Primary">Nur Logs seit letztem Neustart</MudSwitch>
    <MudTextField @bind-Value="Setting.RepoPath" Label="Repo Pfad" Variant="Variant.Filled" Class="mb-2" />
    <MudTextField @bind-Value="Setting.ShopThemesPath" Label="Shop Themes Pfad" Variant="Variant.Filled" Class="mb-2" />
    <MudButton OnClick="Save" Color="Color.Primary" Variant="Variant.Filled" Class="mt-4">Speichern</MudButton>
</MudPaper>

@code {
    private ToolboxSettings Setting => SettingsService.Settings;
    private ServerManager _manager = new ServerManager();
    
    protected override void OnInitialized()
    {
        _manager = new Microsoft.Web.Administration.ServerManager();
    }
    
    private void Save()
    {
        SettingsService.Save();
    }
}
