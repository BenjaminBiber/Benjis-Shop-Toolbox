        if (!string.IsNullOrWhiteSpace(currentFromCsproj))
        {
            Console.WriteLine($"Aktuelle App-Version (csproj): {currentFromCsproj}");
        }

        while (true)
        {
            Console.Write("Bitte neue Versionsnummer eingeben (z.B. 1.2.3 oder 1.2.3.4). ");
            if (!string.IsNullOrWhiteSpace(currentFromCsproj))
                Console.Write($"Aktuell: {currentFromCsproj}. ");
            Console.Write("Eingabe 'q' zum Abbruch: ");
            var input = Console.ReadLine();

            if (input is null)
            {
                return null;
            }

            input = input.Trim();
            if (string.Equals(input, "q", StringComparison.OrdinalIgnoreCase) ||
                string.Equals(input, "quit", StringComparison.OrdinalIgnoreCase) ||
                string.Equals(input, "exit", StringComparison.OrdinalIgnoreCase))
            {
                return null;
            }

            var normalized = Normalize(input);
            if (IsValidVersion(normalized))
            {
                return normalized;
            }

            Console.ForegroundColor = ConsoleColor.Yellow;
            Console.Error.WriteLine("Ungültiges Format. Erlaubt sind 3 oder 4 numerische Segmente.");
            Console.Error.WriteLine("Beispiele: 1.2.3, 1.2.3.4 (auch Trennzeichen ',', '_' oder '-' werden akzeptiert)");
            Console.ResetColor();
        }
    }

    private static string Normalize(string value)
    {
        // 'v' oder 'V' Präfixe erlauben (z.B. v1.2.3)
        var s = (value ?? string.Empty).Trim();
        if (s.StartsWith('v') || s.StartsWith('V'))
        {
            s = s[1..];
        }
        // Erlaube ',', '_' und '-' als Trenner und normalisiere auf '.'
        s = s.Replace(',', '.').Replace('_', '.').Replace('-', '.');
        while (s.Contains("..")) s = s.Replace("..", ".");
        s = s.Trim('.');
        return s;
    }

    private static bool IsValidVersion(string value)
    {
        // Nach Normalize: Nur numerische Segmente mit '.', 3 oder 4 Segmente
        if (string.IsNullOrWhiteSpace(value)) return false;

        var regex = new System.Text.RegularExpressions.Regex(@"^\d+(?:\.\d+){2,3}$", System.Text.RegularExpressions.RegexOptions.CultureInvariant);
        if (!regex.IsMatch(value)) return false;

        return Version.TryParse(value, out _);
    }

    private static bool TryGetCurrentCsprojVersion(out string version)
    {
        version = string.Empty;
        try
        {
            var path = FindCsprojPath();
            if (path is null) return false;
            var doc = System.Xml.Linq.XDocument.Load(path);
            var ns = doc.Root?.Name.Namespace ?? System.Xml.Linq.XNamespace.None;
            var versionElem = doc.Root?
                .Elements(ns + "PropertyGroup")
                .Select(pg => pg.Element(ns + "Version"))
                .FirstOrDefault(e => e != null);
            if (versionElem != null && !string.IsNullOrWhiteSpace(versionElem.Value))
            {
                version = Normalize(versionElem.Value);
                return true;
            }
        }
        catch { }
        return false;
    }
}
