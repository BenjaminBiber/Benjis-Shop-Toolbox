                        Console.WriteLine($"[{appName}] …warte weiterhin auf Debugger…");
                        last = DateTime.UtcNow;
                    }
                }
                Console.WriteLine($"[{appName}] Debugger angehängt.");
            }
        }
        catch
        {
            // ignore
        }
    }

    private static bool TryUpdateToolboxCsprojVersion(string versionText, out string csprojPath, out string error)
    {
        csprojPath = string.Empty;
        error = string.Empty;

        try
        {
            var path = FindCsprojPath();
            if (path is null)
            {
                error = "Toolbox.csproj nicht gefunden (Suche ab AppContext.BaseDirectory).";
                return false;
            }

            if (!Version.TryParse(versionText, out var v))
            {
                error = $"Ungültige Version: {versionText}";
                return false;
            }

            var fourPart = $"{v.Major}.{v.Minor}.{(v.Build >= 0 ? v.Build : 0)}.{(v.Revision >= 0 ? v.Revision : 0)}";

            var doc = XDocument.Load(path, LoadOptions.PreserveWhitespace);
            if (doc.Root is null)
            {
                error = "Ungültige csproj-Struktur (Root fehlt).";
                return false;
            }

            var ns = doc.Root.Name.Namespace;
            var propGroups = doc.Root.Elements(ns + "PropertyGroup").ToList();
            var targetGroup = propGroups.FirstOrDefault(pg => pg.Attribute("Condition") == null)
                              ?? propGroups.FirstOrDefault();
            if (targetGroup == null)
            {
                targetGroup = new XElement(ns + "PropertyGroup");
                doc.Root.Add(targetGroup);
            }

            void SetOrAdd(string name, string value)
            {
                var existing = doc.Root!
                    .Elements(ns + "PropertyGroup")
                    .Select(pg => pg.Element(ns + name))
                    .FirstOrDefault(e => e != null);
                if (existing != null)
                {
                    existing.Value = value;
                }
                else
                {
                    targetGroup.Add(new XElement(ns + name, value));
                }
            }

            SetOrAdd("Version", versionText);       // NuGet/Produktversion (3- oder 4-teilig)
            SetOrAdd("AssemblyVersion", fourPart);   // AssemblyVersion (4-teilig)
            SetOrAdd("FileVersion", fourPart);       // Dateiversion (4-teilig)

            doc.Save(path);
            csprojPath = path;
            return true;
        }
        catch (Exception ex)
        {
            error = ex.Message;
            return false;
        }
    }

    private static string? FindCsprojPath()
    {
        try
        {
            var dir = new DirectoryInfo(AppContext.BaseDirectory);
            for (var d = dir; d != null; d = d.Parent)
            {
                var byFolder = Path.Combine(d.FullName, "Toolbox", "Toolbox.csproj");
                if (File.Exists(byFolder)) return byFolder;

                var directMatch = Directory.GetFiles(d.FullName, "Toolbox.csproj", SearchOption.TopDirectoryOnly).FirstOrDefault();
                if (directMatch != null) return directMatch;
            }
        }
        catch
        {
            // ignore
        }
        return null;
    }

    private static string? GetVersion(string[] args)
    {
        // 1) Falls als Argument übergeben, zunächst das prüfen
        if (args is { Length: > 0 })
        {
            var candidate = Normalize(args[0]);
            if (IsValidVersion(candidate))
            {
                Console.WriteLine($"Verwende Version aus Argument: {candidate}");
                return candidate;
            }
            Console.Error.WriteLine($"Ungültige Version im Argument: '{args[0]}'");
        }

        // 2) Interaktive Eingabe mit Anzeige der aktuellen Version und Validierung
        var currentFromCsproj = TryGetCurrentCsprojVersion(out var currentVer) ? currentVer : null;
